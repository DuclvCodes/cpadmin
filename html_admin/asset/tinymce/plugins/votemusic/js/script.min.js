$(document).ready(function(){function e(){$(".js_close").removeClass("js_close").click(function(){$(this).parents(".control-group").remove();c--;3==c&&$(".icon-remove").addClass("hide");var a=1;$(".icon-remove").each(function(){$(this).parents(".control-group").find("input:eq(0)").attr("placeholder","L\u1ef1a ch\u1ecdn "+a);a++});return!1})}function f(){$(".btn_upload.js").removeClass("js").click(function(){var a=(new Date).getTime();$(this).attr("id","tkp_"+a);$("#frm_upload").attr("for","tkp_"+
a).find("input").click();return!1})}var d=tinyMCEPopup.editor.selection.getNode();if("DIV"==d.nodeName&&"tkp_area_votemusic"==$(d).attr("class")){var g=$(d).find(".vote_id").text();$.ajax({type:"GET",url:"/api/getVote?id="+g,dataType:"html",success:function(a){var b=jQuery.parseJSON(a);$("#frm_vote input[name=vote_id]").val(g);$("#frm_vote textarea[name=title]").val(b.title);1==b.is_predict&&$("#frm_vote input[name=is_predict]").attr("checked","checked");a=jQuery.parseJSON(b.answers);
b=jQuery.parseJSON(b.youtube);$.each(a,function(a,b){1<a&&$(".add_choose").click();$("#frm_vote .icon-remove:eq("+a+")").parents(".control-group").find("input:eq(0)").val(b)});$.each(b,function(a,b){$("#frm_vote .icon-remove:eq("+a+")").parents(".control-group").find("input:eq(1)").val(b)});$("#lbl_submit").text("C\u1eadp nh\u1eadt")},error:function(a,b){alert("Can't do because: "+b)}})}var c=3;$(".add_choose").click(function(){$(this).parents(".control-group").before('<div class="control-group"><div class="controls"><div class="row-fluid"><div class="span5"><input name="answers[]" value="" class="m-wrap required" placeholder="L\u1ef1a ch\u1ecdn '+
c+'" /></div><div class="span7"><input name="youtube[]" value="" class="m-wrap required" placeholder="Youtube ..." /><a href="#" class="btn green mini btn_upload js">T\u1ea3i l\u00ean</a></div></div><i class="icon-remove js_close"></i></div></div>');e();f();c++;4==c&&$(".icon-remove").removeClass("hide");$(".icon-remove:last").parents(".control-group").find("input:eq(0)").focus();return!1});e();f();$("#frm_vote .required").each(function(){var a=$(this).parents(".control-group");$(this).keyup(function(){a.hasClass("error")&&
a.removeClass("error")});$(this).change(function(){a.hasClass("error")&&a.removeClass("error")})});$("#frm_vote").submit(function(){var a=!1;$(this).find(".required").each(function(){var b=$(this).val();b&&""!=b&&"0"!=b||($(this).parents(".control-group").addClass("error"),a=!0)});if(1==a)return $(this).find(".error:eq(0) .required").focus(),alert("Vui l\u00f2ng nh\u1eadp \u0111\u1ea7y \u0111\u1ee7 th\u00f4ng tin"),!1;var b=$(this).attr("action");$.ajax({type:"POST",url:b,data:$("#frm_vote").serialize(),
dataType:"html",success:function(a){0<$("#frm_vote input[name=vote_id]").val()&&$(d).remove();tinyMCEPopup.editor.execCommand("mceInsertContent",!1,a);tinyMCEPopup.close()},error:function(a,b){alert("Can't do because: "+b)}});return!1});$("#frm_upload input").change(function(){""!=$(this).val()&&$(this).parents("form").submit()});$("#frm_upload").submit(function(){var a=$("#"+$(this).attr("for")).parent().find("input");a.val("Loading ...");$(this).ajaxSubmit({success:function(b,c,d,e){a.val(b)}});
return!1})});